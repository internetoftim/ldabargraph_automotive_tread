<!DOCTYPE html><html>   <head>      <meta http-equiv="content-type" content="text/html; charset=UTF-8">      <script type='text/javascript' src='js/d3.v3.min.js'></script>      <script type='text/javascript' src='js/jquery.js'></script>      <script type='text/javascript' src='js/d3.layout.cloud.js'></script>      <script type="text/javascript" src="js/jquery-ui.min.js"></script>      <script type='text/javascript' src='js/jQRangeSlider-min.js'></script>            <script type='text/javascript' src='js/unicode.js'></script>               <link rel="stylesheet" href="css/iThing.css" type="text/css" />         <style type='text/css'>         .axis path, .axis line {         fill: none;         stroke: black;         shape-rendering: crispEdges;         }         .axis text {         font-size: 11px;         font-weight: bold;         }         #tooltip {         position: absolute;         text-align: center;         width: auto;         height: auto;         padding: 10px;         background-color: white;         -webkit-border-radius: 10px;         -moz-border-radius: 10px;         border-radius: 10px;         -webkit-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);         -moz-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);         box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);         pointer-events: none;         }         #tooltip.hidden {         display: none;         }         #tooltip p {         margin: 0;         font-family: sans-serif;         font-size: 16px;         line-height: 20px;         }         #ldatooltip {         position: absolute;         text-align: center;         width: auto;         height: auto;         padding: 10px;         background-color: white;         -webkit-border-radius: 10px;         -moz-border-radius: 10px;         border-radius: 10px;         -webkit-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);         -moz-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);         box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);         pointer-events: none;         }         #ldatooltip.hidden {         display: none;         }         #ldatooltip p {         margin: 0;         font-family: sans-serif;         font-size: 16px;         line-height: 20px;         }         rect text {         fill: white;         font-weight: bold;         }         #main td{         padding: 5px;           }         body{         font-family: "Century Gothic";         }         div.details{         height: 500px;         }         div.categories{         height: 130px;         }         div.content_column{         border-color: #0B7BA7;         border-collapse: collapse;         border-style: solid;         border-radius: 5px;         -moz-border-radius: 5px;         border-width: 2px;         overflow: auto;         }         td.title{         font-weight: bolder;         color: #0B7BA7;         text-align: center;         }         td.options{         color: #0B7BA7;         text-align: center;         font-weight: bold;         }                  div.single_title,div.single_message{         border-bottom:1px;         border-style:solid;         border-top:0px;         border-right:0px;         border-left:0px;         padding:5px;         border-color: black;                  }         #tree {          font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;          margin: auto;          position: relative;          width: 100%;          display: inline;        }        .node {          border: solid 1px white;          font: 16px "Century Gothic";          line-height: 12px;          overflow: hidden;          position: absolute;          text-indent: 2px;            font-weight: bold;          text-align: center;          vertical-align: center;          color:white;          cursor: pointer;        }        div.selected_cluster{          background: #CC2323;        }              </style>      <script type='text/javascript'>//<![CDATA[         $(function(){                                    var clusterData = [];             var clusterId;             var sliderStart = 0;             var sliderEnd = -1;             var clusters = {};             var sliderMax = 0;             var words;             var filterWords = [];             $("#slider").on("userValuesChanged", function(e, data){                 sliderStart = data.values.min;                 sliderEnd = data.values.max;                 $("#tree").html("");                 //limit object here                 var tmpObj = [];                 clusters["children"].forEach(function(d){                     if(d.size <= sliderEnd && d.size >= sliderStart){                        tmpObj.push(d);                     }                 });                 var clustersTmp= {};                 clustersTmp["name"] = "clusters";                 clustersTmp["children"] = tmpObj                 //DrawTree here;                 var margin = {top: 0, right: 0, bottom: 0, left: 0},                     width = 700 - margin.left - margin.right,                     height = 230 - margin.top - margin.bottom;                 var color = d3.scale.category20c();                 var mousemove = function(d) {                    var xPosition = d3.event.pageX + 5;                    var yPosition = d3.event.pageY + 5;                    d3.select("#tooltip")                      .style("left", xPosition + "px")                      .style("top", yPosition + "px");                    d3.select("#tooltip #count")                      .text(d["count"]);                    d3.select("#tooltip").classed("hidden", false);                 };                 var mouseout = function() {                    d3.select("#tooltip").classed("hidden", true);                 };                                      var treemap = d3.layout.treemap()                     .size([width, height])                     .sticky(true)                     .sort(function(a,b) {                         return a.value - b.value;                     })                     .value(function(d) { return d.size; });                 var div = d3.select("#tree").append("div")                     .style("position", "relative")                     .style("width", (width + margin.left + margin.right) + "px")                     .style("height", (height + margin.top + margin.bottom) + "px")                     .style("left", margin.left + "px")                     .style("top", margin.top + "px")                     .style("margin", "auto");                   var node = div.datum(clustersTmp).selectAll(".node")                       .data(treemap.nodes)                     .enter().append("div")                       .attr("name",function(d) { return d.name;} )                       .attr("class", "node")                       .call(nodePosition)                       .style("background", function(d) { return d.children ? color(d.name) : null; })                       .text(function(d) { return d.children ? null : d.name })                       .on("mousemove", mousemove)                       .on("mouseout", mouseout);                                 });                          $("#thread_titles").delegate("div","click",function(){                 $("div.selected_title").removeClass("selected_title");                 $(this).addClass("selected_title");                 var label = $(this).html();                 //change content of thread_messages here                 $("#thread_messages").html("");                 $.each(clusterData, function(idx,value){                    if(value["thread_title"] == label || label == "ALL"){                        $("#thread_messages").append('<div class="single_message">'+value["paragraph"]+'</div>');                    }                 })             });             $("#tree").delegate("div.node","click",function(){                clusterId = $(this).attr("name");                clusterId = clusterId.toLowerCase();                clusterId = clusterId.replace(/_/g,'');                                if(clusterId){                    $("div.selected_cluster").removeClass("selected_cluster");                    $(this).addClass("selected_cluster");                          $("#graphs").html("");                    $("#thread_messages").html("");                    DrawBars();                }             });             $("#bars_tbl").delegate("#numtopics","change",function(){                $("#graphs").html("");                options = "";                for(i=0; i<$("#numtopics").val(); i++){                    options += '<option value="'+i+'">'+i+'</option>';                }                $("#topicid").empty().append(options);                DrawBars();             });                          $("#bars_tbl").delegate("#ngram, #ldatype, #topicid","change",function(){                $("#graphs").html("");                DrawBars();             });                  function DrawTree(){                                  d3.csv("summary.csv", function(data){                     clusters = {};                     var tmpArr = [];                     clusters["name"] = "clusters";                     sliderMax = 0;                     data.forEach(function(d) {                         var size = Math.log(d.count);                         if(sliderEnd == -1 || size <= sliderEnd){                            tmpArr.push({"name": d.cluster_id, "size": size, "count": d.count});                         }                         if (size > sliderMax){                             sliderMax = size;                         }                     });                     clusters["children"] = tmpArr;                     if(sliderEnd == -1){                        sliderEnd = sliderMax;                     }                     var margin = {top: 0, right: 0, bottom: 0, left: 0},                         width = 1400 - margin.left - margin.right,                         height = 70 - margin.top - margin.bottom;                     var color = d3.scale.category20c();                     var mousemove = function(d) {                        var xPosition = d3.event.pageX + 5;                        var yPosition = d3.event.pageY + 5;                        d3.select("#tooltip")                          .style("left", xPosition + "px")                          .style("top", yPosition + "px");                        d3.select("#tooltip #count")                          .text(d["count"]);                        d3.select("#tooltip").classed("hidden", false);                        d3.select("#tooltip #heading")                          .text(d["name"]);                                             };                     var mouseout = function() {                        d3.select("#tooltip").classed("hidden", true);                     };                                          var treemap = d3.layout.treemap()                         .size([width, height])                         .sticky(true)                         .sort(function(a,b) {                             return a.value - b.value;                         })                         .value(function(d) { return d.size; });                     var div = d3.select("#tree").append("div")                         .style("position", "relative")                         .style("width", (width + margin.left + margin.right) + "px")                         .style("height", (height + margin.top + margin.bottom) + "px")                         .style("left", margin.left + "px")                         .style("top", margin.top + "px")                         .style("margin", "auto");                       var node = div.datum(clusters).selectAll(".node")                           .data(treemap.nodes)                         .enter().append("div")                           .attr("name",function(d) { return d.name;} )                           .attr("class", "node")                           .call(nodePosition)                           .style("background", function(d) { return d.children ? color(d.name) : null; })                           .text(function(d) { return d.children ? null : d.name })                           .on("mousemove", mousemove)                           .on("mouseout", mouseout);                                           $("#slider").rangeSlider({bounds: { min: 0, max: sliderMax},                                                defaultValues: { min: 0, max: sliderMax}});                 });             }             function nodePosition() {               this.style("left", function(d) { return d.x + "px"; })                  .style("top", function(d) { return d.y + "px"; })                  .style("width", function(d) { return Math.max(0, d.dx - 1) + "px"; })                  .style("height", function(d) { return Math.max(0, d.dy - 1) + "px"; })                  .style("line-height", function(d) { return Math.max(0, d.dy - 1) + "px"; });             }                      function DrawBars() {                     var ngram = $("#ngram").val();                  var type = $("#ldatype").val();                 var numtopics = $("#numtopics").val();                 var topicid = $("#topicid").val();                 var mode = "";                                   if(ngram === 'n'){                    mode = "_ngram"                 }                 var csvFile =  "lda" + mode + "/" + clusterId + mode + "_" + numtopics + "T";                 if (type === "tf"){                     csvFile += "_TFIDF.csv";                 } else {                     csvFile += ".csv";                 }                 console.log(csvFile);                 d3.csv(csvFile,function(data){                     words = data;                                          var margins = {top: 12,left: 150,right: 30,bottom: 24};                     width = 1200 - margins.left - margins.right;                     //height = 400;                                         obj = []                                                               data.forEach(function(d) {                        if ($("#topicid").val() == d.topicid && filterWords.indexOf(d.word) < 0){                           obj.push(d);                        }                     });                                          obj = obj.sort(function(a,b){                       count_a = parseFloat(a["count"]);                       count_b = parseFloat(b["count"]);                       return count_b > count_a  ? 1 : ((count_b < count_a ? -1 : 0));                     })                     height = 20 * obj.length;                     dataset = [{                         data: obj,                         name: 'Series #1'                     }                     ];                     series = dataset.map(function (d) {                         return d.name;                     });                     dataset = dataset.map(function (d) {                         return d.data.map(function (o, i) {                             // Structure it so that your numeric                             // axis (the stacked amount) is y                             return {                                 y: o.count,                                 x: o.word                             };                         });                     });                     stack = d3.layout.stack();                                      stack(dataset);                     var dataset = dataset.map(function (group) {                         return group.map(function (d) {                             // Invert the x and y values, and y0 becomes x0                             return {                                 x: d.y,                                 y: d.x,                                 x0: d.y0                             };                         });                     }),                     svg = d3.select('#graphs')                         .append('svg')                         .attr('width', width + margins.left + margins.right)                         .attr('height', height + margins.top + margins.bottom)                         .append('g')                         .attr('transform', 'translate(' + margins.left + ',' + margins.top + ')'),                     xMax = d3.max(dataset, function (group) {                         return d3.max(group, function (d) {                             return d.x + d.x0;                         });                     }),                     xScale = d3.scale.linear()                         .domain([0, xMax])                         .range([0, width]),                     months = dataset[0].map(function (d) {                         return d.y;                     }),                     yScale = d3.scale.ordinal()                         .domain(months)                         .rangeRoundBands([0, height], .1),                     xAxis = d3.svg.axis()                         .scale(xScale)                         .orient('bottom'),                     yAxis = d3.svg.axis()                         .scale(yScale)                         .orient('left'),                     colours = d3.scale.category10(),                     groups = svg.selectAll('g')                         .data(dataset)                         .enter()                         .append('g')                         ,                     rects = groups.selectAll('rect')                         .data(function (d) {                         return d;                     })                         .enter()                         .append('rect')                         .attr('x', function (d) {                         return xScale(d.x0);                     })                         .attr('y', function (d, i) {                         return yScale(d.y);                     })                         .attr('height', function (d) {                         return yScale.rangeBand();                     })                         .attr('width', function (d) {                         return xScale(d.x);                     })                         .style('fill', function (d, i) {                         return colours(i);                     }),                     texts = groups.selectAll('text')                         .data(function (d) {                         return d;                     })                         .enter()                         .append('text')                         .attr('x', function (d) {                         return xScale(d.x);                     })                         .attr('y', function (d, i) {                         return yScale(d.y) + 17;                     })                         .attr('height', function (d) {                         return yScale.rangeBand();                     })                         .text(function(d){                         return d.x;                     })                         .style('fill', 'black');                                                               svg.append('g')                         .attr('class', 'axis')                         .attr('transform', 'translate(0,' + height + ')')                         .call(xAxis);                                      svg.append('g')                         .attr('class', 'axis yaxis')                                                  .call(yAxis)                         .style('cursor','pointer');                                                                                });                                                                     }             DrawTree();         });                           //]]>       </script>   </head>   <body>      <table width="100%" id="main" height="100%">         <tr>            <td colspan="2">               <div class="content_column categories">                  <table width="100%">                     <tr>                        <td>                          <br>                          <div id="tree"></div>                          <div id="tooltip" class="hidden">                            <p><strong id="heading"># of Records</strong></p>                            <p><span id="count"></span></p>                          </div>                        </td>                     </tr>                  </table>               </div>                          </td>                    </tr>         <tr>            <td>               <div class="content_column details">                  <table id="bars_tbl" width="100%">                     <tr>                        <td class="title">Top Terms</td>                     </tr>                     <tr>                        <td class="options">                          nGram:                           <select id="ngram">                              <option value = "1"> 1Gram</option>                              <option value = "n"> nGram </option>                          </select>                                                      Type:                           <select id="ldatype">                              <option value = "cnt"> Word Count </option>                              <option value = "tf"> TF </option>                          </select>                                                  # of Topics:                           <select id="numtopics">                              <option value = "3"> 3 </option>                              <option value = "5"> 5 </option>                              <option value = "7"> 7 </option>                          </select>                          Topic Id:                           <select id="topicid">                              <option value = "0"> 0 </option>                               <option value = "1"> 1 </option>                              <option value = "2"> 2 </option>                          </select>                                                  </td>                     </tr>                     <tr>                        <td id="graphs"></td>                     </tr>                  </table>               </div>            </td>         </tr>      </table>   </body></html>